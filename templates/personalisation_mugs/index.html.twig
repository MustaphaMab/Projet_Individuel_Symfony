{% extends 'base.html.twig' %}

{% block title %}Personnalisation de Mug{% endblock %}

{% block body %}
    <h1>Personnalisation de Mug</h1>
    <div class="container">
        <div class="card box-shadow">
            <img id="mug-image" class="card-img-top" src="{{ asset('images/' ~ defaultMug.photo) }}" alt="{{ defaultMug.nom }}">
            <div class="card-body">
                <h2 id="mug-name">{{ defaultMug.nom }}</h2>
                <p id="mug-description" class="card-text">{{ defaultMug.description }}</p>
                <p id="mug-price">{{ defaultMug.prix / 100 }} €</p>
                <label for="color-select">Choisir une couleur :</label>
                <select id="color-select" class="form-control">
                    <option value="">Sélectionner</option>
                    {% for mug in mugs %}
                        <option value="{{ mug.id }}">{{ mug.couleur }}</option>
                    {% endfor %}
                </select>
                <input type="hidden" id="selected-mug-id" value="{{ defaultMug.id }}">
                <button class="btn btn-outline-secondary mt-3" onclick="changeMugColor()">Changer de couleur</button>
                <button class="btn btn-outline-secondary mt-3" onclick="addToCart()">Ajouter au panier</button>
            </div>
        </div>
    </div>

    <script>
        function changeMugColor() {
            const mugId = document.getElementById('color-select').value;
            if (mugId) {
                fetch(`/personalisation/mugs/get/${mugId}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const mug = data.mug;
                            document.getElementById('mug-image').src = `/images/${mug.photo}`;
                            document.getElementById('mug-name').innerText = mug.nom;
                            document.getElementById('mug-description').innerText = mug.description;
                            document.getElementById('mug-price').innerText = `${mug.prix / 100} €`;
                            document.getElementById('selected-mug-id').value = mug.id;
                        } else {
                            alert('Erreur: ' + data.message);
                        }
                    })
                    .catch(() => alert('Erreur lors du changement de couleur.'));
            }
        }

        function addToCart() {
            const mugId = document.getElementById('selected-mug-id').value;
            fetch(`/cart/add/${mugId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ color: document.getElementById('color-select').value })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('Produit ajouté avec succès!');
                    } else {
                        alert('Erreur: ' + data.message);
                    }
                })
                .catch(() => alert('Erreur lors de l\'ajout au panier.'));
        }
    </script>
{% endblock %}
